<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/vlasiator_manual/libs/highlight/github.min.css"> <link rel=stylesheet  href="/vlasiator_manual/css/jtd.css"> <link rel=icon  href="/vlasiator_manual/assets/favicon.ico"> <title>Installation</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/vlasiator_manual/" class=title > Vlasiator </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/vlasiator_manual/" class="menu-list-link ">Home</a> <li class="menu-list-item active"><a href="/vlasiator_manual/menu1/" class="menu-list-link active">Installation</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu2/" class="menu-list-link ">Run</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu3/" class="menu-list-link ">Postprocessing</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu4/" class="menu-list-link ">Internal</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="#" class=menu-list-link >SysBoundary</a> </ul> <li class="menu-list-item "><a href="/vlasiator_manual/menu5/" class="menu-list-link ">Misc</a> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="/vlasiator_manual//github.com/fmihpc/vlasiator">Vlasiator on GitHub</a> </div> <div class=franklin-content ><h1 id=installation ><a href="#installation" class=header-anchor >Installation</a></h1> <div class=franklin-toc ><ol><li><a href="#a_brief_history_of_the_build_system">A Brief History of the Build System</a><li><a href="#dccrg">DCCRG</a><li><a href="#zoltan">Zoltan</a><li><a href="#boost">Boost</a><li><a href="#eigen">Eigen</a><li><a href="#phiprof">PHIPROF</a></ol></div> <h2 id=a_brief_history_of_the_build_system ><a href="#a_brief_history_of_the_build_system" class=header-anchor >A Brief History of the Build System</a></h2> <p>There are several issues with the current file system:</p> <ul> <li><p>Source files should not be present on the top level.</p> <li><p>External library linking is a nightmare if you start on a new machine.</p> <li><p>The Makefile lists every single source file with repetitive flags. The flags and preprocessor settings are buried in the long Makefile which makes it hard to modify if necessary.</p> <li><p>Vlasiator depends on many packages. It takes a huge effort to install the code on a new machine, mainly due to the dependency hell.</p> </ul> <p>To handle the fore-mentioned problems, I propose three major changes:</p> <ol> <li><p>Reorganize the file levels.</p> <li><p>Rewrite the Makefile.</p> <li><p>Add a new configuration file.</p> </ol> <p>I have come across several round of modification trying to make the new build system simple and useful.</p> <ol> <li><p>For a fresh new machine,</p> </ol> <pre><code class="shell hljs">./configure.py -h</code></pre>
<p>shows the available options. By default options with prefix <code>-</code> require no arguments, and options with prefix <code>--</code> require one argument.</p>
<pre><code class="shell hljs">./configure.py -install</code></pre>
<p>tries to install all the dependencies in the new <code>lib</code> folder except Boost. On Ubuntu it is often installed under the default folder; on supercomputers there is usually a module to load.</p>
<ol start=2 >
<li><p>To access an existing customized Makefile in <code>MAKE</code> folder with library paths and compiler flags, e.g.</p>

</ol>
<pre><code class="shell hljs">./configure.py --machine=yann</code></pre>
<p>then it will include the preset library paths in the main Makefile. By default it links to <code>MAKE/Makefile.default</code>.</p>
<ol start=3 >
<li><p>To quickly setup the library paths on a new machine, you create a new makefile <code>MAKE/Makefile.yours</code> and set the required links.</p>

</ol>
<p>Then this can be called with <code>./configure.py --machine&#61;yours</code>.</p>
<p>I still keep the options of changing order of solvers, floating point precisions, etc.. Even though they rarely change, it is still changeable, but the default is set to the most common options.</p>
<p>I do not provide support for python2, since the official support has also ended by the end of 2020. It will warn you about obsolete python version.</p>
<p>The tools should in principle also be able to be compiled, but for now it is not guaranteed to work.</p>
<h2 id=dccrg ><a href="#dccrg" class=header-anchor >DCCRG</a></h2>
<p>DCCRG is the underlying grid and MPI library for Vlasiator. I guess this provides similar functionality compared to <strong>AMReX</strong> and <strong>BATL</strong>.</p>
<h2 id=zoltan ><a href="#zoltan" class=header-anchor >Zoltan</a></h2>
<p>Zoltan is used to do loading balancing, or spatial partitioning of the computation.</p>
<p>It can be downloaded from Sandia&#39;s website: <a href="http://cs.sandia.gov/Zoltan/Zoltan_Distributions/zoltan_distrib_v3.83.tar.gz">Zoltan</a>.</p>
<h2 id=boost ><a href="#boost" class=header-anchor >Boost</a></h2>
<p>I don&#39;t know what Boost is used for. Maybe argument parsing?</p>
<h2 id=eigen ><a href="#eigen" class=header-anchor >Eigen</a></h2>
<p>No idea what Eigen is used for. However, the latest Eigen version has compilation error in assertions:</p>
<pre><code class="shell hljs">3.3.8
/home/hyzhou/include/Eigen/src/Core/products/Parallelizer.h:162:40: error: ‘eigen_assert_exception’ is not a member of ‘Eigen’
  162 |   if (errorCount) EIGEN_THROW_X(Eigen::eigen_assert_exception());
      |                                        ^~~~~~~~~~~~~~~~~~~~~~
/home/hyzhou/include/Eigen/src/Core/util/Macros.h:1017:34: note: in definition of macro ‘EIGEN_THROW_X’</code></pre>
<h2 id=phiprof ><a href="#phiprof" class=header-anchor >PHIPROF</a></h2>
<p>PHIPROF is the profiler library used, which is very similar to the timer library in SWMF written in Fortran.</p>
<p>Currently I need to load the dynamic library like this:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >export</span> LD_LIBRARY_PATH=/home/<span class=hljs-keyword >local</span>/hongyang/Vlasiator/vlasiator/lib/phiprof/lib</code></pre>
<div class=page-foot >
  <div class=copyright >
    &copy; Hongyang Zhou. Last modified: February 20, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->