<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/vlasiator_manual/libs/katex/katex.min.css"> <link rel=stylesheet  href="/vlasiator_manual/libs/highlight/github.min.css"> <link rel=stylesheet  href="/vlasiator_manual/css/jtd.css"> <link rel=icon  href="/vlasiator_manual/assets/favicon.ico"> <title>Run</title> <div class=page-wrap > <div class=side-bar > <div class=header > <a href="/vlasiator_manual/" class=title > Vlasiator </a> </div> <label for=show-menu  class=show-menu >MENU</label> <input type=checkbox  id=show-menu  role=button > <div class=menu  id=side-menu > <ul class=menu-list > <li class="menu-list-item "><a href="/vlasiator_manual/" class="menu-list-link ">Home</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/" class="menu-list-link ">Installation</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#dccrg" class=menu-list-link >DCCRG</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#zoltan" class=menu-list-link >Zoltan</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#boost" class=menu-list-link >Boost</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#eigen" class=menu-list-link >Eigen</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#jemalloc" class=menu-list-link >Jemalloc</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#phiprof" class=menu-list-link >PhiProf</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu1/#papi" class=menu-list-link >Papi</a> </ul> <li class="menu-list-item active"><a href="/vlasiator_manual/menu2/" class="menu-list-link active">Run</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu3/" class="menu-list-link ">Postprocessing</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu4/" class="menu-list-link ">Internal</a> <ul class="menu-list-child-list "> <li class="menu-list-item "><a href="/vlasiator_manual/menu4/#sysboundary" class=menu-list-link >SysBoundary</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu4/#vlasov_solver" class=menu-list-link >Vlasov Solver</a> </ul> <li class="menu-list-item "><a href="/vlasiator_manual/menu5/" class="menu-list-link ">Test</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu6/" class="menu-list-link ">Misc</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu7/" class="menu-list-link ">Method</a> <li class="menu-list-item "><a href="/vlasiator_manual/menu8/" class="menu-list-link ">Trouble Shooting</a> </ul> </div> <div class=footer > This is <em>Just the docs</em>, adapted from the <a href="https://github.com/pmarsceill/just-the-docs" target=_blank >Jekyll theme</a>. </div> </div> <div class=main-content-wrap > <div class=main-content > <div class=main-header > <a id=github  href="/vlasiator_manual//github.com/fmihpc/vlasiator">Vlasiator on GitHub</a> </div> <div class=franklin-content ><h1 id=running_vlasiator ><a href="#running_vlasiator" class=header-anchor >Running Vlasiator</a></h1> <div class=franklin-toc ><ol><li><a href="#input_configuration_file">Input Configuration File</a><ol><li><a href="#general">General</a><li><a href="#grid">Grid</a><li><a href="#species_velocity_space">Species &amp; Velocity Space</a><li><a href="#solvers">Solvers</a><li><a href="#boundary_conditions">Boundary Conditions</a><li><a href="#initial_conditions">Initial conditions</a><li><a href="#parallelization">Parallelization</a><li><a href="#io">IO</a></ol><li><a href="#runtime_control">Runtime Control</a></ol></div> <p>To run the code,</p> <pre><code class="shell hljs">vlasiator --run_config run.cfg</code></pre>
<p>To run from restart,</p>
<pre><code class="shell hljs">vlasiator --run_config run.cfg --restart.filename restart.vlsv</code></pre>
<p>To check all the available options,</p>
<pre><code class="shell hljs">vlasiator --help</code></pre>
<p>The current executable is designed to be able to read in command line arguments. However, the list is just too long to check and read. Also, you cannot use tab to auto-complete input file names&#33; It is really annoying to type the cfg file name as an argument into the command line everytime when I try to run the code. Maybe we can set some default locations, like looking for cfg files in the current directory?</p>
<p>The speed difference between <code>-O0</code> and <code>-O3</code> can be 120/9&#61;13 times&#33; This is quite significant. Thanks compiler&#33;</p>
<h2 id=input_configuration_file ><a href="#input_configuration_file" class=header-anchor >Input Configuration File</a></h2>
<p>There is no manual for the configuration parameters currently. However, there is a script helping to identify potential errors in the configuration file, <code>tools/check_vlasiator_cfg.sh</code>. To run that,</p>
<pre><code class="shell hljs">./check_vlasiator_cfg.sh vlasiator test.cfg</code></pre>
<ul>
<li><p>Orders of commands</p>
<ul>
<li><p>On the command line, all options are either one word &#40;top level&#41; or of the format block.option, they can be in any order. See below for composite option.</p>

<li><p>In a cfg: blocks can be in any order. Top-level options should be at the top, anything after a block title will be counted in that block until the next option. Inside one block, single options can be in any order. See below for composite options.</p>

<li><p>Composed options: There is options that can be repeated any number of times, e.g. <code>variables.output</code> to specify more than one output variable. Those can be in any order. However there is a few specific cases where we implemented several composed options to go in groups. In particular, the specification of output file types with the root name of the file type, its frequency, and how many VDFs we want to store. There one has to make sure that the options are in order so that the group of options goes together.</p>

</ul>

<li><p>Commands are case-sensitive, except output and diagnostic variable names.</p>

<li><p>Normalization</p>
<ul>
<li><p>All input units are SI.</p>

<li><p>All plasma parameters are set in the project you choose.</p>

</ul>

<li><p>The help message printed from <code>vlasiator --help</code> may be incomplete,outdated, wrong, or missing. When in doubt, check out the source code instead.</p>

<li><p>There are these <code>proton_</code> prefix syntax for many tags. Vlasiator supports more than one ion population. That population&#39;s name &#40;e.g. <code>proton</code>&#41; gets prepended to a host of options that are specific to that population, like densities, temperatures, boundary behaviour etc.</p>

<li><p>How to restart a run?</p>
<ul>
<li><p>If the options are set so that restart files come out, you will get files called <code>restart.INDEX.DATE.vlsv</code>. INDEX is seven digits in seconds of simulation time, DATE is the date of the file.</p>

<li><p>When you want to restart from a given file, use the option <code>restart.filename</code> pointing to that file. In job scripts for multi-stage runs one trick is to use the option on the command line/in the job script as <code>--restart.filename &#36;&#40; ls -tr | restart.*.vlsv | tail -n 1 &#41;</code>.</p>

</ul>

</ul>
<h3 id=general ><a href="#general" class=header-anchor >General</a></h3>
<pre><code class="YAML hljs"><span class=hljs-string >project</span> <span class=hljs-string >=</span> <span class=hljs-string >Flowthrough</span>
<span class=hljs-string >propagate_field</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >propagate_vlasov_acceleration</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >propagate_vlasov_translation</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >dynamic_timestep</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >ParticlePopulations</span> <span class=hljs-string >=</span> <span class=hljs-string >proton</span>
<span class=hljs-string >hallMinimumRho</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span></code></pre>
<ul>
<li><p><code>project</code>: type of problems to solve &#40;options?&#41;</p>
<ul>
<li><p>In the git repository under the projects directory you can find the available projects. Some are old and may be unsupported. Projects may support custom options &#40;e.g defining the dipole field for the Magnetosphere project&#41;</p>

</ul>

<li><p><code>propagate_field</code>: field solver on/off</p>

<li><p><code>propagate_vlasov_acceleration</code>: acceleration on/off</p>

<li><p><code>propagate_vlasov_translation</code>: translation on/off</p>

<li><p><code>dynamic_timestep</code>: 0 or 1 to have static or dynamic dt</p>

<li><p><code>ParticlePopulations</code>: ion species name, this is arbitrary and is prepended to all the options relevant to that population. Can be repeated to initialize multiple ion species.</p>

<li><p><code>hallMinimumRho</code>: minimum rho value used for the Hall and electron pressure gradient terms in the Lorentz force and in the field solver. This is a common trick in avoiding near-vaccum region in the hybrid simulations where extremely small timesteps can occur. However, this may not be enough by itself.</p>

</ul>
<p>One thing to notice here is that currently local timestepping is not available. This should be added to speed up the steady state runs.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >bailout</span>]
<span class=hljs-string >max_memory</span> <span class=hljs-string >=</span> <span class=hljs-number >55</span>
<span class=hljs-string >min_dt</span> <span class=hljs-string >=</span> <span class=hljs-number >1e-3</span>
<span class=hljs-string >velocity_space_wall_block_margin</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span> <span class=hljs-comment ># number of vblocks away from the vextent</span></code></pre>
<p>Stop the run if any of the criteria is violated. The memory limit is only working when PAPI is used&#33;</p>
<h3 id=grid ><a href="#grid" class=header-anchor >Grid</a></h3>
<p>All the values are assumed to be in SI units.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >gridbuilder</span>]
<span class=hljs-string >x_length</span> <span class=hljs-string >=</span> <span class=hljs-number >20</span>      <span class=hljs-comment ># number of cells in x</span>
<span class=hljs-string >y_length</span> <span class=hljs-string >=</span> <span class=hljs-number >20</span>      <span class=hljs-comment ># number of cells in x</span>
<span class=hljs-string >z_length</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>       <span class=hljs-comment ># number of cells in x</span>
<span class=hljs-string >x_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-1.3e8</span>     <span class=hljs-comment ># minimum x location, [m]</span>
<span class=hljs-string >x_max</span> <span class=hljs-string >=</span> <span class=hljs-number >1.3e8</span>      <span class=hljs-comment ># maximum x location, [m]</span>
<span class=hljs-string >y_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-1.3e8</span>     <span class=hljs-comment ># minimum y location, [m]</span>
<span class=hljs-string >y_max</span> <span class=hljs-string >=</span> <span class=hljs-number >1.3e8</span>      <span class=hljs-comment ># maximum y location, [m]</span>
<span class=hljs-string >z_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-6.5e6</span>     <span class=hljs-comment ># minimum z location, [m]</span>
<span class=hljs-string >z_max</span> <span class=hljs-string >=</span> <span class=hljs-number >6.5e6</span>      <span class=hljs-comment ># maximum z location, [m]</span>
<span class=hljs-string >t_max</span> <span class=hljs-string >=</span> <span class=hljs-number >650</span>        <span class=hljs-comment ># maximum physical time allowed, [s]</span>
<span class=hljs-string >dt</span> <span class=hljs-string >=</span> <span class=hljs-number >2.0</span>           <span class=hljs-comment ># fixed timestep if static dt is applied, [s]</span>
<span class=hljs-string >timestep_max</span> <span class=hljs-string >=</span> <span class=hljs-number >100</span> <span class=hljs-comment ># maximum number of iterations allowed</span></code></pre>
<p>Boundary cells &#40;typically 1 layer?&#41; are included in <code>x_length</code>, etc.</p>
<p>My guess is that if any of the limits is reached, the simulation will terminate.</p>
<ul>
<li><p><code>dt</code> is the single time step length &#40;used if dynamic dt is disabled&#41;</p>

<li><p><code>timestep_max</code> is the max number of timesteps taken until the run stops</p>

<li><p><code>t_max</code> is the max simulaton time until the run stops</p>

</ul>
<p>Note that if we are running with a fixed timestep, we need to make sure that it is within the CFL condition. Based on my tests, the scheme for translation is not TVD when the CFL number goes beyond 0.9. I need to check the numerical scheme used underneath.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >AMR</span>]
<span class=hljs-string >max_spatial_level</span> <span class=hljs-string >=</span> <span class=hljs-number >2</span>
<span class=hljs-string >box_half_width_x</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>  <span class=hljs-comment ># Half width of the refined box [# of base grid cells]</span>
<span class=hljs-string >box_half_width_z</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >box_half_width_y</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >box_center_x</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>      <span class=hljs-comment ># x coord of the center of the refined box</span>
<span class=hljs-string >box_center_y</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>      <span class=hljs-comment ># y coord of the center of the refined box</span>
<span class=hljs-string >box_center_z</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>      <span class=hljs-comment ># z coord of the center of the refined box</span>
<span class=hljs-string >filterpasses</span>          <span class=hljs-comment ># AMR filter passes for each individual refinement level?</span></code></pre>
<p>The AMR settings are basically hard-coded in each project, which explains why this input parameter list is so simple:&#41;</p>
<p>Outer boundary cells must have identical refinement levels as the first layer of physical cells as of Vlasiator 5.1.</p>
<p>I also see a parameter for setting the AMR in velocity space, but it&#39;s not been used anywhere probably.</p>
<p>Is it possible to do mesh refinement in 1D or 2D? Yes, but it also depends on what kind of boundary we are using.</p>
<h3 id=species_velocity_space ><a href="#species_velocity_space" class=header-anchor >Species &amp; Velocity Space</a></h3>
<p>Normalization, mass and charge</p>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_properties</span>]
<span class=hljs-string >mass</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >mass_units</span> <span class=hljs-string >=</span> <span class=hljs-string >PROTON</span>
<span class=hljs-string >charge</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span></code></pre>
<ul>
<li><p><code>mass_units</code>: PROTON or ELECTRON &#40;at the latest once the electorn branch is merged&#41;</p>

</ul>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_vspace</span>]
<span class=hljs-string >vx_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-600000.0</span> <span class=hljs-comment ># minimum vx value resolved, [m/s]</span>
<span class=hljs-string >vx_max</span> <span class=hljs-string >=</span> <span class=hljs-string >+600000.0</span> <span class=hljs-comment ># maximum vx value resolved, [m/s]</span>
<span class=hljs-string >vy_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-600000.0</span> <span class=hljs-comment ># minimum vy value resolved, [m/s]</span>
<span class=hljs-string >vy_max</span> <span class=hljs-string >=</span> <span class=hljs-string >+600000.0</span> <span class=hljs-comment ># maximum vy value resolved, [m/s]</span>
<span class=hljs-string >vz_min</span> <span class=hljs-string >=</span> <span class=hljs-number >-600000.0</span> <span class=hljs-comment ># minimum vz value resolved, [m/s]</span>
<span class=hljs-string >vz_max</span> <span class=hljs-string >=</span> <span class=hljs-string >+600000.0</span> <span class=hljs-comment ># maximum vz value resolved, [m/s]</span>
<span class=hljs-string >vx_length</span> <span class=hljs-string >=</span> <span class=hljs-number >15</span>     <span class=hljs-comment ># number of blocks in x</span>
<span class=hljs-string >vy_length</span> <span class=hljs-string >=</span> <span class=hljs-number >15</span>     <span class=hljs-comment ># number of blocks in y</span>
<span class=hljs-string >vz_length</span> <span class=hljs-string >=</span> <span class=hljs-number >15</span>     <span class=hljs-comment ># number of blocks in z</span></code></pre>
<p>Each velocity block consists of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn><mo>×</mo><mn>4</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">4\times 4\times 4</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >4</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >4</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >4</span></span></span></span> cells. These so-called cellblocks are aimed for vectorization. The block sizes are defined as constants. The minimum and maximum values set the extensions of the velocity space cells. Note that discrepencies between input and output moment values will occur if the velocity space is poorly sampled. To determine the proper velocity cell resolution, you need to calculate the thermal velocity <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mo stretchy=false >(</mo></msqrt><msub><mi>k</mi><mi>B</mi></msub><mi>T</mi><mi mathvariant=normal >/</mi><msub><mi>m</mi><mi>p</mi></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\sqrt(k_B T/m_p)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.24em;vertical-align:-0.30499999999999994em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.935em;"><span class=svg-align  style="top:-3.2em;"><span class=pstrut  style="height:3.2em;"></span><span class=mopen  style="padding-left:1em;">(</span></span><span style="top:-2.8950000000000005em;"><span class=pstrut  style="height:3.2em;"></span><span class=hide-tail  style="min-width:1.02em;height:1.28em;"><svg width='400em' height='1.28em' viewBox='0 0 400000 1296' preserveAspectRatio='xMinYMin slice'><path d='M263,681c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l0 -0
c4.7,-7.3,11,-11,19,-11
H40000v40H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.30499999999999994em;"><span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class=mord >/</span><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.15139200000000003em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.286108em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, which acts as a characteristic width of the Maxwellian distribution, and make sure the velocity cell is small enough to resolve the distribution. Currently this is still empirical; maybe in the future we can add an assertion check for this criterion.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_sparse</span>]
<span class=hljs-string >minValue</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e-15</span> <span class=hljs-comment ># distribution function threshold</span>
<span class=hljs-string >dynamicAlgorithm</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> 
<span class=hljs-string >dynamicMinValue1</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span> <span class=hljs-comment ># The minimum value for the dynamic minValue</span></code></pre>
<p>This command sets the threshold for resolving a distribution. For typical magnetospheric plasma parameters, phase-space density peaks out between <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>12</mn></mrow></msup></mrow><annotation encoding="application/x-tex">1\times10^{-12}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord ><span class=mord >0</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mrow><mo>−</mo><mn>9</mn></mrow></msup><mtext> </mtext><msup><mtext>m</mtext><mrow><mtext>⁻</mtext><mn>6</mn></mrow></msup><msup><mtext>s</mtext><mn>3</mn></msup></mrow><annotation encoding="application/x-tex">1\times 10^{-9}\ \text{m}^{⁻6}\text{s}^3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >×</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8141079999999999em;vertical-align:0em;"></span><span class=mord >1</span><span class=mord ><span class=mord >0</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">9</span></span></span></span></span></span></span></span></span><span class=mspace > </span><span class=mord ><span class="mord text"><span class=mord >m</span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">⁻</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord text"><span class=mord >s</span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span></span></span>.</p>
<p>There are some additional options for setting sparsity:</p>
<ul>
<li><p><code>dynamicAlgorithm</code>: type of algorithm used for calculating the dynamic minValue. <code>0</code> is none, <code>1</code> is linear algorithm based on rho, <code>2</code> is linear algorithm based on blocks. Example linear algorithm: y &#61; kx&#43;b, where dynamicMinValue1&#61;k<em>dynamicBulkValue1 &#43; b, and dynamicMinValue2 &#61; k</em>dynamicBulkValue2 &#43; b.</p>

</ul>
<p>I need to ask about this.</p>
<h3 id=solvers ><a href="#solvers" class=header-anchor >Solvers</a></h3>
<pre><code class="YAML hljs">[<span class=hljs-string >fieldsolver</span>]
<span class=hljs-string >ohmHallTerm</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> <span class=hljs-comment ># spatial order of the Hall term in Ohm&#x27;s law, {0: &#x27;off&#x27;, 1, 2}</span>
<span class=hljs-string >minCFL</span> <span class=hljs-string >=</span> <span class=hljs-number >0.4</span>
<span class=hljs-string >maxCFL</span> <span class=hljs-string >=</span> <span class=hljs-number >0.5</span>
<span class=hljs-string >resistivity</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span> <span class=hljs-comment ># Resistivity for the ηJ term in Ohm&#x27;s law.</span>
<span class=hljs-string >diffusiveEterms</span> <span class=hljs-string >=</span> <span class=hljs-literal >true</span> <span class=hljs-comment ># Enable diffusive terms in the computation of E</span>
<span class=hljs-string >ohmGradPeTerm</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> <span class=hljs-comment ># spatial order of ∇Pₑ/ne in Ohm&#x27;s law. 0: off, 1: 1st order.</span>
<span class=hljs-string >electronTemperature</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span> <span class=hljs-comment ># Upstream electron temperature to be used for ∇Pₑ/ne, [K]</span>
<span class=hljs-string >electronDensity</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span> <span class=hljs-comment ># Upstream electron density to be used for ∇Pₑ/ne, [m^-3]</span>
<span class=hljs-string >electronPTindex</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> <span class=hljs-comment ># Polytropic index for ∇Pₑ/ne. 0: isobaric, 1: isothermal, 1.667: adiabatic</span>
<span class=hljs-string >maxWaveVelocity</span> <span class=hljs-string >=</span> <span class=hljs-string >Inf</span> <span class=hljs-comment ># ?, [m/s]</span>

[<span class=hljs-string >vlasovsolver</span>]
<span class=hljs-string >minCFL</span> <span class=hljs-string >=</span> <span class=hljs-number >0.8</span>
<span class=hljs-string >maxCFL</span> <span class=hljs-string >=</span> <span class=hljs-number >0.99</span>
<span class=hljs-string >maxSlAccelerationRotation</span> <span class=hljs-string >=</span> <span class=hljs-number >25</span> <span class=hljs-comment ># maximum allowed rotation per subcycle</span>
<span class=hljs-string >maxSlAccelerationSubcycles</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span></code></pre>
<p>The default values are shown above.</p>
<ul>
<li><p><code>ohmHallTerm</code>: 0, 1 or 2, that is the spatial order of accuracy of the Hall term in the field solver &#40;0 turns it off altogether&#41;</p>

<li><p><code>minCFL</code> and <code>maxCFL</code>: set a bracket for the allowed range of the CFL number between &#91;0,1&#93; to run that solver component at. Note that the field solver is instable between 0.5 and 1, so it should not be run at higher than 0.5. I don&#39;t know why there is a lower limit for CFL.</p>

<li><p><code>maxWaveVelocity</code>: I suspect this sets the maximum wave speed manually in the solver. I will test on this&#33;</p>

</ul>
<h3 id=boundary_conditions ><a href="#boundary_conditions" class=header-anchor >Boundary Conditions</a></h3>
<ul>
<li><p><code>precedence</code>: Don&#39;t touch that or it might well be unstable. It says which boundary condition is chosen &#40;higher precedence&#41; over another at corners where two types meet.</p>

<li><p><code>&#43;</code>,<code>-</code>: &#40;see –help, &#43; is the positive side/highest coordinate, - is the negative/lower side&#41;</p>

</ul>
<p>Current boundary settings</p>
<pre><code class="YAML hljs">[<span class=hljs-string >boundaries</span>]
<span class=hljs-string >periodic_x</span> <span class=hljs-string >=</span> <span class=hljs-literal >no</span>
<span class=hljs-string >periodic_y</span> <span class=hljs-string >=</span> <span class=hljs-literal >yes</span>
<span class=hljs-string >periodic_z</span> <span class=hljs-string >=</span> <span class=hljs-literal >yes</span>
<span class=hljs-string >boundary</span> <span class=hljs-string >=</span> <span class=hljs-string >Outflow</span>
<span class=hljs-string >boundary</span> <span class=hljs-string >=</span> <span class=hljs-string >Maxwellian</span>
<span class=hljs-string >boundary</span> <span class=hljs-string >=</span> <span class=hljs-string >Ionosphere</span></code></pre>
<ul>
<li><p><code>boundary</code>: type of boundary class that will be initialised and usable in the run. The actual boundary type for each face is explicitly controlled by the tag with the same boundary type below.</p>
<ul>
<li><p><code>Outflow</code>: so far this is a Neumann condition &#40;copy-condition fo the nearest simulation cell&#41;</p>

</ul>

</ul>
<pre><code class="YAML hljs">[<span class=hljs-string >outflow</span>]
<span class=hljs-string >precedence</span> <span class=hljs-string >=</span> <span class=hljs-number >3</span>
[<span class=hljs-string >proton_outflow</span>]
<span class=hljs-string >face</span> <span class=hljs-string >=</span> <span class=hljs-string >x-</span>
<span class=hljs-string >face</span> <span class=hljs-string >=</span> <span class=hljs-string >y-</span>
<span class=hljs-string >face</span> <span class=hljs-string >=</span> <span class=hljs-string >y+</span></code></pre>
<ul>
<li><p><code>Maxwellian</code>: Takes the values from the provided <code>.dat</code> file, <code>time density temperature Vx Vy Vz Bx By Bz</code>, partial support for time-variation is already in the code. It might be helpful to add a header line to the <code>.dat</code> file&#33;</p>

</ul>
<pre><code class="YAML hljs">[<span class=hljs-string >maxwellian</span>]
<span class=hljs-string >face</span> <span class=hljs-string >=</span> <span class=hljs-string >x+</span>
<span class=hljs-string >precedence</span> <span class=hljs-string >=</span> <span class=hljs-number >4</span>
<span class=hljs-string >reapplyUponRestart</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>

[<span class=hljs-string >proton_maxwellian</span>]
<span class=hljs-string >dynamic</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >file_x+</span> <span class=hljs-string >=</span> <span class=hljs-string >sw1.dat</span></code></pre>
<p>Note: <code>reapplyUponRestart</code> by default is 0, which means keeping going with the state existing in the restart file. If set to 1, it calls again <code>applyInitialState&#40;&#41;</code>. This can be used to change boundary condition behaviour during a run, and currently it must be set to 1 for applying time varying boundary condition&#33;</p>
<ul>
<li><p><code>Ionosphere</code>: ionospheric inner boundary</p>

</ul>
<pre><code class="YAML hljs">[<span class=hljs-string >ionosphere</span>]
<span class=hljs-string >centerX</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>   <span class=hljs-comment ># ?</span>
<span class=hljs-string >centerY</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>   <span class=hljs-comment ># ?</span>
<span class=hljs-string >centerZ</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>   <span class=hljs-comment ># ?</span>
<span class=hljs-string >radius</span> <span class=hljs-string >=</span> <span class=hljs-number >38.2e6</span> <span class=hljs-comment ># ?</span>
<span class=hljs-string >precedence</span> <span class=hljs-string >=</span> <span class=hljs-number >2</span>  <span class=hljs-comment ># ?</span>

[<span class=hljs-string >proton_ionosphere</span>]
<span class=hljs-string >taperRadius</span> <span class=hljs-string >=</span> <span class=hljs-number >100.0e6</span>
<span class=hljs-string >rho</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e6</span></code></pre>
<p>I can guess the meanings, but shall there be better alternatives? Let&#39;s discuss, but some options are population-specific for example. Maybe something like</p>
<pre><code class="YAML hljs">[<span class=hljs-string >boundary</span>]
<span class=hljs-string >boundary_x</span> <span class=hljs-string >=</span> <span class=hljs-string >Outflow</span>
<span class=hljs-string >boundary_y</span> <span class=hljs-string >=</span> <span class=hljs-string >Maxwellian</span>
<span class=hljs-string >boundary_z</span> <span class=hljs-string >=</span> <span class=hljs-string >Periodic</span>
<span class=hljs-string >boundary_inner</span> <span class=hljs-string >=</span> <span class=hljs-string >Ionosphere</span></code></pre>
<p>Internally we almost don&#39;t need to change anything, except a check on the strings.</p>
<h3 id=initial_conditions ><a href="#initial_conditions" class=header-anchor >Initial conditions</a></h3>
<pre><code class="YAML hljs">[<span class=hljs-string >Flowthrough</span>]
<span class=hljs-string >emptyBox</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>  <span class=hljs-comment ># ?</span>
<span class=hljs-string >Bx</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e-9</span>   <span class=hljs-comment ># background B field, [T]</span>
<span class=hljs-string >By</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e-9</span>   <span class=hljs-comment ># background B field, [T]</span>
<span class=hljs-string >Bz</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e-9</span>   <span class=hljs-comment ># background B field, [T]</span>
<span class=hljs-string >densityModel</span> <span class=hljs-string >=</span> <span class=hljs-string >SheetMaxwellian</span> <span class=hljs-comment ># ?</span></code></pre>
<ul>
<li><p><code>emptyBox</code>: deprecated/undocumented, remnant from a separate project by Arto</p>

<li><p><code>densityModel</code>: deprecated/undocumented, remnant from a separate project by Arto</p>

</ul>
<p>The deprecated command can be safely ignored for now.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_Flowthrough</span>]
<span class=hljs-string >T</span> <span class=hljs-string >=</span> <span class=hljs-number >100000.0</span>         <span class=hljs-comment ># initial temperature, [K]</span>
<span class=hljs-string >rho</span>  <span class=hljs-string >=</span> <span class=hljs-number >1000000.0</span>     <span class=hljs-comment ># initial number density, [/m^3]</span>
<span class=hljs-string >VX0</span> <span class=hljs-string >=</span> <span class=hljs-number >4e5</span>            <span class=hljs-comment ># initial velocity in x, [m/s]</span>
<span class=hljs-string >VY0</span> <span class=hljs-string >=</span> <span class=hljs-number >4e5</span>            <span class=hljs-comment ># initial velocity in y, [m/s]</span>
<span class=hljs-string >VZ0</span> <span class=hljs-string >=</span> <span class=hljs-number >4e5</span>            <span class=hljs-comment ># initial velocity in z, [m/s]</span>
<span class=hljs-string >nSpaceSamples</span> <span class=hljs-string >=</span> <span class=hljs-number >2</span>    <span class=hljs-comment ># number of samples per cell per spatial dimension to take to compute the VDF</span>
<span class=hljs-string >nVelocitySamples</span> <span class=hljs-string >=</span> <span class=hljs-number >2</span> <span class=hljs-comment ># number of samples per cell per veloctiy dimension to take to compute the VDF</span></code></pre>
<ul>
<li><p>The idea is to improve the initial sampling when generating the VDF by sampling/averaging over N^3 points per vcell or spatial cell. However due among others to numerical diffusion and so on, it makes little difference whether you sample with 2³ or 5³ points, except that initialization takes exponentially longer. Thus Yann suggest to drop these features.</p>

</ul>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_Magnetosphere</span>]
<span class=hljs-string >T</span> <span class=hljs-string >=</span> <span class=hljs-number >100000.0</span>         <span class=hljs-comment ># initial temperature, [K]</span>
<span class=hljs-string >rho</span> <span class=hljs-string >=</span> <span class=hljs-number >1.0e5</span>          <span class=hljs-comment ># initial number density, [/m^3]</span>
<span class=hljs-string >VX0</span> <span class=hljs-string >=</span> <span class=hljs-number >-5.0e5</span>         <span class=hljs-comment ># initial velocity in x, [m/s] </span>
<span class=hljs-string >VY0</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>            <span class=hljs-comment ># initial velocity in x, [m/s]</span>
<span class=hljs-string >VZ0</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>            <span class=hljs-comment ># initial velocity in x, [m/s]</span>
<span class=hljs-string >nSpaceSamples</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>    <span class=hljs-comment ># number of samples per cell per spatial dimension to take to compute the VDF</span>
<span class=hljs-string >nVelocitySamples</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span> <span class=hljs-comment ># number of samples per cell per veloctiy dimension to take to compute the VDF</span></code></pre>
<p>These are two different projects, only one can be active in any given run &#40;and usually only one si set in a given cfg&#41;. However, since they appear essentially the same, we may be able to merge them into one tag.</p>
<p>The temperature determines the initial width of the Maxwellian distribution function. As an estimation, the thermal speed is</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>v</mi><mrow><mi>t</mi><mi>h</mi></mrow></msub><mo>=</mo><msqrt><mfrac><mrow><msub><mi>k</mi><mi>B</mi></msub><mi>T</mi></mrow><mi>m</mi></mfrac></msqrt></mrow><annotation encoding="application/x-tex">
v_{th} = \sqrt{\frac{k_B T}{m}}
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">h</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.44em;vertical-align:-0.7634050000000001em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.6765949999999998em;"><span class=svg-align  style="top:-4.4em;"><span class=pstrut  style="height:4.4em;"></span><span class=mord  style="padding-left:1em;"><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03148em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.6365950000000002em;"><span class=pstrut  style="height:4.4em;"></span><span class=hide-tail  style="min-width:1.02em;height:2.48em;"><svg width='400em' height='2.48em' viewBox='0 0 400000 2592' preserveAspectRatio='xMinYMin slice'><path d='M424,2478
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l0 -0c4,-6.7,10,-10,18,-10 H400000
v40H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M1001 80
h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7634050000000001em;"><span></span></span></span></span></span></span></span></span></span>
<p>with a constant factor depending on the dimension and exact definition. For instance, protons of 1K has a thermal speed of about 90 m/s.  This will effect the discrete velocity space in Vlasiator due to finite resolution and width. For example, if the temperature is very low, the distribution is approximately a Dirac distribution. Therefore, the distribution will only locate within one velocity cell, and thus taking the velocity value as the cell center value instead of the input value listed above. The output velocity &#40;and other moments&#41; would be way off if the velocity space resolution is low w.r.t. the thermal speed.</p>
<p>The other thing worths noticing is that there will be numerical errors. Even if you set a periodic boundary with a set of constant input parameters, the output velocity will still fluctuates on the order of machine precision.</p>
<p>If for some reason you need to force the number density, you can use the <code>conserve_mass</code> flag which re-scales the VDF to match the original value after it&#39;s been populated.</p>
<p>Background field</p>
<pre><code class="YAML hljs">[<span class=hljs-string >Magnetosphere</span>]
<span class=hljs-string >constBgBX</span> <span class=hljs-string >=</span> <span class=hljs-number >-3.0e-9</span> <span class=hljs-comment ># constant background magnetic field x component</span>
<span class=hljs-string >constBgBY</span> <span class=hljs-string >=</span> <span class=hljs-number >3.0e-9</span>  <span class=hljs-comment ># y</span>
<span class=hljs-string >constBgBZ</span> <span class=hljs-string >=</span> <span class=hljs-number >3.0e-9</span>  <span class=hljs-comment ># z</span>
<span class=hljs-string >noDipoleInSW</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>    <span class=hljs-comment ># if 1, no dipole B in inflow BC cells</span>
<span class=hljs-string >dipoleType</span> <span class=hljs-string >=</span> <span class=hljs-number >2</span>      <span class=hljs-comment ># vector dipole</span>
<span class=hljs-string >dipoleMirrorLocationX</span> <span class=hljs-string >=</span> <span class=hljs-number >3.88e8</span></code></pre>
<ul>
<li><p><code>dipoleType</code></p>
<ul>
<li><p>0: Normal 3D dipole</p>

<li><p>1: line-dipole for 2D polar simulations</p>

<li><p>2: line-dipole with mirror</p>

<li><p>3: 3D dipole with mirror</p>

</ul>

<li><p><code>dipoleMirrorLocationX</code>: location of the mirror dipole, which is used to cancel the components of the dipole field in the solar wind as if it is a perfect conductor. It should be set to <code>2*&#40;xmax-2*cellsize&#41;</code> manually if inflow is coming from the &#43;x direction.</p>

</ul>
<h3 id=parallelization ><a href="#parallelization" class=header-anchor >Parallelization</a></h3>
<pre><code class="YAML hljs">[<span class=hljs-string >loadBalance</span>]
<span class=hljs-string >rebalanceInterval</span> <span class=hljs-string >=</span> <span class=hljs-number >10</span> <span class=hljs-comment ># time step interval for load balance</span></code></pre>
<h3 id=io ><a href="#io" class=header-anchor >IO</a></h3>
<p>There is a diagnostic file and a log file.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_thermal</span>]
<span class=hljs-string >radius</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> <span class=hljs-comment ># radius of the Maxwellian distribution, [m/s]</span>
<span class=hljs-string >vx</span> <span class=hljs-string >=</span> <span class=hljs-number >-5e5</span>  <span class=hljs-comment ># center of the Maxwellian distribution, [m/s]</span>
<span class=hljs-string >vy</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span>
<span class=hljs-string >vz</span> <span class=hljs-string >=</span> <span class=hljs-number >0.0</span></code></pre>
<p>Thermal component paramters used for calculating the thermal/suprathermal moments. A rule of thumb for the choice of <code>radius</code> is to be within a few times the thermal speed obtained upstream. You can also plot some VDFs and look at how the distribution falls off: for non-thermal particle moments, we want values to not be contaminated by the dense solar wind core.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >proton_energydensity</span>]
<span class=hljs-string >solarwindspeed</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >solarwindenergy</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span></code></pre>
<p>Incoming solar wind velocity magnitude in &#91;m/s&#93; and ram energy in &#91;eV&#93;. Used for calculating energy densities.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >io</span>]
<span class=hljs-string >diagnostic_write_interval</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span> <span class=hljs-comment ># time step interval for diagnostic output in diagnostic.txt and PAPI memory report</span>
<span class=hljs-string >write_initial_state</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>       <span class=hljs-comment ># initial value output on/off, before any solver (half)steps are taken to get us to t=0.</span>

<span class=hljs-string >system_write_t_interval</span> <span class=hljs-string >=</span> <span class=hljs-number >649.0</span> <span class=hljs-comment ># Interval in simulation seconds to write that type of file</span>
<span class=hljs-string >system_write_file_name</span> <span class=hljs-string >=</span> <span class=hljs-string >bulk</span>
<span class=hljs-string >write_system_stripe_factor</span> <span class=hljs-string >=</span> <span class=hljs-number >4</span>

<span class=hljs-string >system_write_distribution_stride</span> <span class=hljs-string >=</span> <span class=hljs-number >1</span>
<span class=hljs-string >system_write_distribution_xline_stride</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >system_write_distribution_yline_stride</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>
<span class=hljs-string >system_write_distribution_zline_stride</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span>

<span class=hljs-string >restart_walltime_interval</span> <span class=hljs-string >=</span> <span class=hljs-number >-1</span> <span class=hljs-comment ># Save in given wall time interval. Negative numbers disables writes</span>
<span class=hljs-string >number_of_restarts</span> <span class=hljs-string >=</span> <span class=hljs-number >4294967295</span> <span class=hljs-comment ># Exit the simulation after a certain number of saving restarts above</span>

<span class=hljs-string >write_restart_stripe_factor</span> <span class=hljs-string >=</span> <span class=hljs-number >20</span>

<span class=hljs-string >write_as_float</span> <span class=hljs-string >=</span> <span class=hljs-number >0</span> <span class=hljs-comment ># convert to single precision outputs or not</span></code></pre>
<ul>
<li><p><code>system_write_file_name</code>: it is arbitrary, although we have used <code>bulk</code> for the frequent simulation output files for almost 10 years now.</p>

<li><p><code>system_write_distribution_stride</code>: write out the velocity distribution function every N cells, this is a modulo on the cell&#39;s ID essentially. If this is 0, the separate x,y,z strides have no effects.</p>

<li><p><code>system_write_distribution_xline_stride</code>: write out the VDF every N cells in x &#40;same for y and z&#41;.</p>

<li><p><code>write_restart_stripe_factor</code> and <code>write_system_stripe_factor</code>: speed up lustre IO performance by setting the number of Object Storage Targets &#40;OSTs&#41;. See <a href="https://docs.nersc.gov/performance/io/lustre/">Lustre File Striping</a> for more information. If a file is larger than 10 GB, it would be better to use a larger stripe factor than 1.</p>

<li><p><code>restart_walltime_interval</code>: by default this is negative. If this is positive by <code>number_of_restarts</code> is positive, then the run will immediately stop.</p>

</ul>
<p>It is indeed very strange to make outputs of raw distribution functions under the IO tag instead of &#91;<code>variables</code>&#93;.</p>
<pre><code class="YAML hljs">[<span class=hljs-string >variables</span>]
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >vg_rhom</span>            <span class=hljs-comment ># total mass density, [kg/m^3]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >fg_e</span>               <span class=hljs-comment ># electric field, [V/m]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >fg_b</span>               <span class=hljs-comment ># magnetic field, [T]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >vg_pressure</span>        <span class=hljs-comment ># total thermal pressure, [Pa]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >populations_vg_rho</span> <span class=hljs-comment ># number density for each species, [m^-3]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >populations_vg_v</span>   <span class=hljs-comment ># velocity for each species, [m/s]</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >vg_boundarytype</span>    <span class=hljs-comment ># type of boundaries</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >vg_rank</span>            <span class=hljs-comment ># MPI rank for each cell</span>
<span class=hljs-string >output</span> <span class=hljs-string >=</span> <span class=hljs-string >populations_vg_blocks</span> <span class=hljs-comment ># number of vblocks</span>
<span class=hljs-string >diagnostic</span> <span class=hljs-string >=</span> <span class=hljs-string >populations_vg_blocks</span> <span class=hljs-comment ># number of vblocks</span></code></pre>
<p>All the quantities can be listed after either <code>output</code> or <code>diagnostic</code>.</p>
<ul>
<li><p><code>output</code>: writes to the output vlsv files.</p>

<li><p><code>diagnostic</code>: writes out the min, max, mean and sum of that variable over the whole grid into the <code>diagnostic.txt</code> file. It&#39;s a handy way of monitoring some parameters during a run.</p>

<li><p>Variable name conventions:</p>
<ul>
<li><p><code>fg</code>: variable on the fsgrid field solver grid, at highest resolution throughout.</p>

<li><p><code>vg</code>: variable on the DCCRG Vlasov grid, including AMR in 3D potentially.</p>

<li><p><code>populations</code>: used for moments: write out that &#40;group of&#41; moment&#40;s&#41; for all populations.</p>

<li><p><code>rho</code>: number density, <code>rhom</code>: mass density, <code>rhoq</code>: charge density, <code>v</code>: velocity.</p>

<li><p><code>_thermal/_nonthermal</code>: suffix for isolating thermal/nonthermal moments, used with parameters defined in <code>&#91;populations_thermal&#93;</code>.</p>

</ul>

</ul>
<p>All the output files are in vlsv format, no matter it&#39;s the restart file or regular outputs. The restart file is used for continuing a run, which contains the full distribution, field information and meta data. Typical output file is called bulk file, which may contain various derived quantities every few cells.</p>
<h2 id=runtime_control ><a href="#runtime_control" class=header-anchor >Runtime Control</a></h2>
<p>Quick cheat list:</p>
<ul>
<li><p><code>touch KILL</code> stops the run without a restart written.</p>

<li><p><code>touch STOP</code> stops the run with a restart.</p>

<li><p><code>touch SAVE</code> writes an extra restart &#40;not counted in the number given in the cfg&#41;.</p>

<li><p><code>touch DOLB</code> triggers an additional load balance.</p>

</ul>
<p>All of these are going through the once-per-timestep check if any of these files are present on disk. They get renamed to <code>&lt;file&gt;_&lt;date&gt;</code> to avoid re-triggering and keep a record. However this relies on timesteps proceeding, so if a run is hanging indefinitely there&#39;s nothing you can do bar killing it through linux or queuing system commands.</p>
<p>For more information, check <code>ioread.cpp</code>.</p>
<div class=page-foot >
  <div class=copyright >
    &copy; Hongyang Zhou. Last modified: January 14, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    </div> 
    </div> 
    </div> <!-- end of class page-wrap-->